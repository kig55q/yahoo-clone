<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #ffffff;
            font-family: Arial, sans-serif;
        }
        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Stock Chart</h1>
    <canvas id="stockChart"></canvas>

    <script>
        // 假設數據（您需要替換為真實數據）
        const labels = Array.from({length: 100}, (_, i) => `Day ${i + 1}`);
        const highData = Array.from({length: 100}, () => Math.random() * 100 + 50);
        const lowData = highData.map(h => h - Math.random() * 10);
        const closeData = highData.map((h, i) => (h + lowData[i]) / 2);
        const volumeData = Array.from({length: 100}, () => Math.random() * 1000);

        // 計算均線
        const calculateMA = (data, period) => {
            const ma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    ma.push(null);
                } else {
                    const slice = data.slice(i - period + 1, i + 1);
                    ma.push(slice.reduce((sum, val) => sum + val, 0) / period);
                }
            }
            return ma;
        };

        const ma10 = calculateMA(closeData, 10);
        const ma80 = calculateMA(closeData, 80);
        const vol20 = calculateMA(volumeData, 20);

        // 計算漲跌百分比（基於收盤價與前日收盤價）
        const percentChange = closeData.map((close, i) => {
            if (i === 0) return 0;
            return ((close - closeData[i - 1]) / closeData[i - 1] * 100).toFixed(2);
        });

        const ctx = document.getElementById('stockChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'High',
                        data: highData,
                        borderColor: '#00ff00',
                        fill: false,
                        yAxisID: 'price'
                    },
                    {
                        label: 'Low',
                        data: lowData,
                        borderColor: '#ff0000',
                        fill: false,
                        yAxisID: 'price'
                    },
                    {
                        label: 'Close',
                        data: closeData,
                        borderColor: '#0000ff',
                        fill: false,
                        yAxisID: 'price'
                    },
                    {
                        label: 'MA10',
                        data: ma10,
                        borderColor: '#ffa500',
                        fill: false,
                        yAxisID: 'price'
                    },
                    {
                        label: 'MA80',
                        data: ma80,
                        borderColor: '#800080',
                        fill: false,
                        yAxisID: 'price'
                    },
                    {
                        label: 'Volume',
                        type: 'bar',
                        data: volumeData,
                        backgroundColor: 'rgba(0, 0, 255, 0.3)',
                        yAxisID: 'volume'
                    },
                    {
                        label: 'VOL20',
                        data: vol20,
                        borderColor: '#008080',
                        fill: false,
                        yAxisID: 'volume'
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    price: {
                        type: 'logarithmic',
                        position: 'left',
                        title: { display: true, text: 'Price' }
                    },
                    volume: {
                        position: 'right',
                        title: { display: true, text: 'Volume' },
                        grid: { display: false }
                    },
                    x: {
                        title: { display: true, text: 'Time' }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const datasetLabel = context.dataset.label || '';
                                const value = context.parsed.y.toFixed(2);
                                if (datasetLabel === 'Close') {
                                    const index = context.dataIndex;
                                    const change = percentChange[index];
                                    const color = change >= 0 ? '#00ff00' : '#ff0000'; // 綠色上漲，紅色下跌
                                    return [
                                        `${datasetLabel}: ${value}`,
                                        { text: `Change: ${change}%`, color: color }
                                    ];
                                }
                                return `${datasetLabel}: ${value}`;
                            },
                            labelColor: function(context) {
                                if (context.dataset.label === 'Close') {
                                    const index = context.dataIndex;
                                    const change = percentChange[index];
                                    return {
                                        borderColor: change >= 0 ? '#00ff00' : '#ff0000',
                                        backgroundColor: change >= 0 ? '#00ff00' : '#ff0000'
                                    };
                                }
                                return {
                                    borderColor: context.dataset.borderColor,
                                    backgroundColor: context.dataset.borderColor
                                };
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>